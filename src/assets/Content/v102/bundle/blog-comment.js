require=function e(t,o,n){function i(l,s){if(!o[l]){if(!t[l]){var m="function"==typeof require&&require;if(!s&&m)return m(l,!0);if(r)return r(l,!0);var a=new Error("Cannot find module '"+l+"'");throw a.code="MODULE_NOT_FOUND",a}var u=o[l]={exports:{}};t[l][0].call(u.exports,function(e){var o=t[l][1][e];return i(o?o:e)},u,u.exports,e,t,o,n)}return o[l].exports}for(var r="function"==typeof require&&require,l=0;l<n.length;l++)i(n[l]);return i}({2167:[function(e,t,o){var n=e("../component/layout/default-page-layout.js"),i=(e("../component/blog-comment/view.js"),n.extend({ui:{container:".tpl-join-block"}}));!function(e){new i({el:e(".global-wrapper")}).render()}(jQuery)},{"../component/blog-comment/view.js":200,"../component/layout/default-page-layout.js":1082}],200:[function(e,t,o){var n=(e("underscore"),e("backbone"),e("backbone.marionette")),i=e("../ui/util"),r=e("./model"),l=e("./models/comment-model"),s=e("./models/comment-number"),m=e("../ui/validator"),a=e("../ui/addthis");t.exports=n.ItemView.extend({template:!1,commentModel:new l,commentNumber:null,userModel:i.getUser(),model:new r({},{view:this}),blogId:null,ui:{join:".join-block",comments:".comment-block",reply:".reply-block",blog:".blog-post",joinConversation:".join-conversation"},events:{"click .reply":function(e){this.ui.reply.parentId=e.currentTarget.id,this.$(':input[data-bind="userName"]').focus()},"click .wgt-sqbutton-black.submit":function(){var e=this.trigger("save:form");this.model.set({blogId:e.blogId}),this.model.isValid(!0)&&(e.commentModel.set({blogId:e.blogId,parentId:this.ui.reply.parentId,comment:e.model.get("comment"),userName:e.model.get("userName"),userEmail:e.model.get("userEmail")}),i.loading({container:e.ui.reply,errortimeout:1e4,promise:e.commentModel.save(e.commentModel.attributes).then(function(t){t.success?(e.ui.reply.parentId="",e.$(":input").each(function(e,t){jQuery(t).val("")}),e.initUserInfo(),i.loading({container:e.ui.join,promise:e.commentNumber.getCommentNumber()}),i.loading({container:e.el,promise:e.model.getComments()})):i.error(e.ui.reply,t.message)})}))},"click .wgt-sqbutton-dark.cancel":function(){var e=this;e.ui.reply.parentId="",jQuery(e.ui.comments).toggle(),jQuery(e.ui.reply).toggle()},"click .join-block":function(){var e=this;jQuery(e.ui.comments).toggle(),jQuery(e.ui.reply).toggle(),jQuery(e.ui.joinConversation).toggleClass("active"),e.model.get("comments")||(e.initUserInfo(),i.loading({container:e.el,promise:e.model.getComments()}))}},initialize:function(){this.blogId=jQuery(this.ui.blog).data("product-id"),this.model.blogId=this.blogId,this.commentNumber=new s({blogId:this.blogId})},onRender:function(){m.bind(this);var t=this;a.then(function(){addthis.toolbox(".addthis_toolbox",{ui_508_compliant:!0})}),t.resultsTemplate=Handlebars.compile(e("./template0.hbs")),Handlebars.registerPartial("list",e("./template1.hbs")),t.model.on("change:comments",function(){t.ui.comments.html(t.resultsTemplate(t.model.get("comments").models))}),i.loading({container:t.ui.join,promise:t.commentNumber.getCommentNumber()}),t.commentNumber.on("change:total",function(){t.$(".comment-num").html(t.commentNumber.get("total"))})},initUserInfo:function(){var e=this;e.userModel.isLoggedIn()&&(e.$(":input[data-bind='userName']").val(e.userModel.get("first_name")+" "+e.userModel.get("last_name")),e.$(":input[data-bind='userEmail']").val(e.userModel.get("email")))}})},{"../ui/addthis":2047,"../ui/util":2122,"../ui/validator":2123,"./model":194,"./models/comment-model":196,"./models/comment-number":197,"./template0.hbs":198,"./template1.hbs":199,backbone:8,"backbone.marionette":6,underscore:42}],199:[function(e,t,o){t.exports='\r\n\r\n{{#each this}}\r\n    <div>\r\n        <p class="name">{{attributes.userName}}\r\n            <span class="date">{{attributes.date}}</span>\r\n        </p>\r\n        <p>\r\n            {{#if attributes.disabled}}\r\n                <span style="color:red;font-weight:bold">[{{local "Blogs.the_comment_delete"}}]</span>\r\n            {{else}}\r\n                {{attributes.comment}}\r\n            {{/if}}\r\n        </p>\r\n        <a class="reply" id="{{attributes.commentId}}">Reply</a>\r\n        {{#if attributes.list.models}}\r\n            <div class="child-comment-block">\r\n                {{>list attributes.list.models}}\r\n            </div>\r\n        {{/if}}\r\n    </div>\r\n{{/each}}\r\n'},{}],198:[function(e,t,o){t.exports="{{>list this}}"},{}],197:[function(e,t,o){var n=(e("underscore"),e("backbone")),i=e("../../../../config/host.js");t.exports=n.Model.extend({defaults:{total:-1},initialize:function(e){this.url=i.getURL("api","blogcomment/number?blogid="+e.blogId)},getCommentNumber:function(){var e=this;return jQuery.when(e.fetch()).then(function(t){e.set({total:t.total})})}})},{"../../../../config/host.js":45,backbone:8,underscore:42}],194:[function(e,t,o){var n=(e("underscore"),e("backbone"),e("../ui/paginator/view-model")),i=e("./models/comment-collection"),r=e("../ui/validator");o=t.exports=n.extend({blogId:"",defaults:{blogId:"",comment:"",userName:"",userEmail:"",comments:null},validation:{blogId:{required:!0},comment:{required:!0,pattern:r.latinNumericsSymbols,maxLength:1e3},userName:{required:!0,pattern:r.latinRegex3},userEmail:{required:!0,pattern:"email"}},initialize:function(){},getComments:function(){var e=this,t=new i({blogId:this.blogId});return t.promise=t.fetch().then(function(){t.convertList(),e.set({comments:t})}),t.promise}})},{"../ui/paginator/view-model":2103,"../ui/validator":2123,"./models/comment-collection":195,backbone:8,underscore:42}],195:[function(e,t,o){var n=e("underscore"),i=e("backbone"),r=e("./comment-model"),l=e("../../../../config/host.js"),s=t.exports=i.Collection.extend({model:r,initialize:function(e){var t=this;t.url=l.getURL("api","blogcomment/list?blogid="+e.blogId)},convertList:function(){var e=this;n.each(e.models,function(e){e.set({list:new s(e.get("list"))}),e.get("list").convertList()})}})},{"../../../../config/host.js":45,"./comment-model":196,backbone:8,underscore:42}],196:[function(e,t,o){var n=(e("underscore"),e("backbone")),i=e("../../../../config/host.js");t.exports=n.Model.extend({url:i.getURL("api","blogcomment/add"),defaults:{commentId:"",blogId:"",parentId:"",comment:"",userName:"",userEmail:"",disabled:!1,date:"",list:[]}})},{"../../../../config/host.js":45,backbone:8,underscore:42}]},{},[2167]);