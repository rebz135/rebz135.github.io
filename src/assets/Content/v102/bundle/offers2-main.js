require=function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return o(n?n:e)},f,f.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({2254:[function(e,t,n){var i=e("../component/layout/default-page-layout"),o=e("../component/offers-2.0/view"),r=e("../component/count-down/count-down"),s=i.extend({ui:{mainWrapper:".main-wrapper .offers2"},onRender:function(){this.onDestroy(),this.ui.mainWrapper.length&&(this._mainView=new o({el:this.ui.mainWrapper.get(0)}).render())},onDestroy:function(){this._mainView&&(this._mainView.destroy(),this._mainView=null)}});new s({el:jQuery(".global-wrapper").get(0)}).render(),e("./heart-beat"),window.offerId&&jQuery("#count-down").length&&new r({el:"#count-down",params:window.offerId,type:"hotel"}).render()},{"../component/count-down/count-down":768,"../component/layout/default-page-layout":1082,"../component/offers-2.0/view":1525,"./heart-beat":2199}],1525:[function(e,t,n){var i=e("backbone.marionette"),o=e("./01-caption/view"),r=e("./02-toolbar/view"),s=e("./03-listing/view"),a=e("./04-feature/view"),u=e("./05-maps/view"),l=e("./states");t.exports=i.ItemView.extend({template:!1,ui:{caption:".offers2__caption",toolbar:".offers2__toolbar",listing:".offers2__listing",feature:".offers2__feature",maps:".offers2__maps",wipe:".offers2__toolbar-wipe"},onRender:function(){var e=this;e.onDestroy(),e.ui.caption.length&&(e._captionView=new o({el:e.ui.caption.get(-1),rootState:l}).render()),e.ui.toolbar.length&&(e._toolbarView=new r({el:e.ui.toolbar.get(-1),rootState:l}).render()),e.ui.listing.length&&(e._listingView=new s({el:e.ui.listing.get(-1),rootState:l}).render(),e._listingView.on("wipe:hide",function(){e.ui.wipe.hide()}),e._listingView.on("wipe:show",function(){e.ui.wipe.show()})),e.ui.feature.length&&(e._featureView=new a({el:e.ui.feature.get(-1),rootState:l}).render()),e.ui.maps.length&&(e._mapsView=new u({el:e.ui.maps.get(-1),rootState:l}).render()),e.addLoadingForImage()},onDestroy:function(){var e=this;e._captionView&&(e._captionView.destroy(),e._captionView=null),e._toolbarView&&(e._toolbarView.destroy(),e._toolbarView=null),e._listingView&&(e._listingView.destroy(),e._listingView=null),e._featureView&&(e._featureView.destroy(),e._featureView=null),e._mapsView&&(e._mapsView.destroy(),e._mapsView=null)},addLoadingForImage:function(){var e=this;jQuery(".offers2__listing-region-img").each(function(){e.addImageListener(this)}),jQuery(".offers2__listing-offer-img").each(function(){e.addImageListener(this)})},addImageListener:function(e){var t=jQuery(e).data("offer-img"),n=new Image;n.onload=function(){jQuery(e).removeClass("image-loading")},n.src=t}})},{"./01-caption/view":1492,"./02-toolbar/view":1511,"./03-listing/view":1512,"./04-feature/view":1520,"./05-maps/view":1521,"./states":1523,"backbone.marionette":6}],1523:[function(e,t,n){function i(e){return s.filter(s.sortBy(s.filter(e,{parentid:""}),"name"),function(t){return s.findIndex(e,{parentid:t.id})>=0})}function o(e,t){for(var n=r(s.sortBy(s.filter(e,t),"name")),i=0,o=n.length;o>i;i++)n[i].children=r(s.filter(e,{parentid:n[i].id}));return n}function r(e){var t=s.findIndex(e,{key:"china"}),n=s.findIndex(e,{key:"taiwan"}),i=s.findIndex(e,{key:"taichung"}),o=e[t];if(o||i>-1){var r=o&&o.children||e,a=s.findIndex(r,function(e){return"taichung"===e.key});a>0&&r.push(r.splice(a,1)[0])}if(t>=0&&n>=0){var u=e.splice(n,1);n>t?e.splice(t+1,0,u[0]):e.splice(t,0,u[0])}return e}var s=e("underscore"),a=e("backbone"),u=e("./stores"),l={getListByKeyword:s.debounce(function(e){e?u.getListByKeyword(e).then(function(t){f.trigger("showResultPanel",{key:e,val:t})}):f.trigger("showResultPanel",null)},500),getAllOffersType:function(){u.getAllOffersType().then(function(e){f.trigger("popupOffersType",e)})},getAllOffersMenu:function(){u.getAllOffersMenu().then(function(e){f.trigger("popupOffersMenu",{region:i(e),nation:o(e,{level:"country"})})})},getFeatureOffers:function(){u.getFeatureOffers().then(function(e){f.trigger("showBottomPanel",e)})},menuItemSelected:function(e){f.trigger("sliceOffersName",e),u.getAllOffersMenu().then(function(t){f.trigger("sliceOffersMenu",o(t,{parentid:e.id}))})},typeItemSelected:function(e){f.trigger("closeFullScreen"),f.trigger("sliceOffersList",e)},clearConditions:function(){f.trigger("closeFullScreen"),f.trigger("wholeOffersList")}},f=s.extend({listenEvent:function(e){return this.on(e,function(){l[e]&&l[e].apply(this,arguments)})}},a.Events);t.exports=f.listenEvent("getListByKeyword").listenEvent("getAllOffersType").listenEvent("getAllOffersMenu").listenEvent("getFeatureOffers").listenEvent("menuItemSelected").listenEvent("typeItemSelected").listenEvent("clearConditions")},{"./stores":1524,backbone:8,underscore:42}],1524:[function(e,t,n){function i(){return!1}function o(e){var t=jQuery.Deferred();return setTimeout(function(){t.resolve(e)}),t.promise()}function r(e){var t=s();return t?d.map(e,function(e){return d.assign({},e,{url:e.url+(e.url.indexOf("?")>=0?"&":"?")+t})}):e}function s(){var e=a(location.search);return e.keywords?"keywords="+encodeURIComponent(e.keywords):void 0}function a(e){return d.object(d.filter(d.map(e.slice(1).split("&"),function(e){return d.map(e.split("="),function(e){return decodeURIComponent(e.replace("+","%20"))})}),function(e){return 2===e.length}))}var u,l,f,c,p,d=e("underscore"),g=e("../../../config/host"),h=e("./compress");if(i()){var w=g.getLanguage();sessionStorage.getItem("CURRENT_LANGUAGE")!==w&&(sessionStorage.setItem("CURRENT_LANGUAGE",w),sessionStorage.removeItem("ALL_OFFERS_TYPE"),sessionStorage.removeItem("ALL_OFFERS_MENU"))}t.exports={getListByKeyword:function(e){return u&&u.abort(),u=jQuery.getJSON(g.getURL("api","offers/search"),{keywords:e,isM4B:!!window.isforbusiness}),u.then(function(e){return o(e)},function(){return o([])})},getAllOffersType:function(){return c?o(c):i()&&sessionStorage.getItem("ALL_OFFERS_TYPE")?o(c=h.inflateRaw(sessionStorage.getItem("ALL_OFFERS_TYPE"))):(l&&l.abort(),l=jQuery.getJSON(g.getURL("api","offers/tags"),{isM4B:!!window.isforbusiness}),l.then(function(e){return i()&&sessionStorage.setItem("ALL_OFFERS_TYPE",h.deflateRaw(e)),o(c=e)}))},getAllOffersMenu:function(){return p?o(r(p)):i()&&sessionStorage.getItem("ALL_OFFERS_MENU")?o(r(p=h.inflateRaw(sessionStorage.getItem("ALL_OFFERS_MENU")))):(f&&f.abort(),f=jQuery.getJSON(g.getURL("api","offers/locations"),{isM4B:!!window.isforbusiness}),f.then(function(e){return i()&&sessionStorage.setItem("ALL_OFFERS_MENU",h.deflateRaw(e)),o(r(p=e))}))},getFeatureOffers:function(){return o(d.map(window.bottomFeaturedOffers||[],function(e){return d.assign({imageUrl:e.thumbnail,imageAnchor:e.image_anchor,feature_offers_title:i18n.t(e.isforbusiness?"offers.featured_business_offers":"offers.featured_offers"),hiddenTitle:window.isforbusiness},e)}))}}},{"../../../config/host":45,"./compress":1522,underscore:42}],1521:[function(e,t,n){var i=e("backbone.marionette"),o=e("../../city-map/view");t.exports=i.LayoutView.extend({template:!1,regions:{maps:".map-content"},onRender:function(){window.mapHotels&&window.mapHotels.length&&this.getRegion("maps").show(new o)}})},{"../../city-map/view":766,"backbone.marionette":6}],1492:[function(e,t,n){var i=e("backbone.marionette"),o=e("./01-search/view"),r=e("./02-slides/view");t.exports=i.ItemView.extend({template:!1,ui:{mask:".offers2__caption-mask",content:".offers2__caption-content",feature:".offers2__caption-feature"},onRender:function(){this.onDestroy(),this.__initialEventHwd(),this.ui.content.length&&(this._searchToolBarView=new o({el:this.ui.content.get(0),rootState:this.options.rootState}).render()),this.ui.feature.length&&(this._featureOffersView=new r({el:this.ui.feature.get(0),rootState:this.options.rootState}).render())},onDestroy:function(){this._searchToolBarView&&(this._searchToolBarView.destroy(),this._searchToolBarView=null),this._featureOffersView&&(this._featureOffersView.destroy(),this._featureOffersView=null)},__initialEventHwd:function(){var e=this,t=e.options.rootState;e.stopListening(t),e.listenTo(t,"showCaptionMask",e.__showCaptionMask),e.listenTo(t,"hideCaptionMask",e.__hideCaptionMask)},__showCaptionMask:function(){this.ui.mask.addClass("show")},__hideCaptionMask:function(){this.ui.mask.removeClass("show")}})},{"./01-search/view":1490,"./02-slides/view":1491,"backbone.marionette":6}],1491:[function(e,t,n){var i=e("swiper"),o=e("backbone.marionette");t.exports=o.ItemView.extend({template:!1,ui:{container:".swiper-container",pagination:".swiper-pagination"},onRender:function(){this.onDestroy(),this.ui.container.length&&(this._swiper=new i(this.ui.container.get(0),{pagination:this.ui.pagination.get(0),paginationClickable:!0,autoplay:5e3,loop:!0}))},onDestroy:function(){this._swiper&&(this._swiper.destroy(!0),this._swiper=null)}})},{"backbone.marionette":6,swiper:40}],1490:[function(e,t,n){var i=(e("underscore"),e("backbone")),o=e("backbone.marionette"),r=e("./container/view"),s=e("../../../../../config/host");t.exports=o.LayoutView.extend({template:!1,ui:{feint:".offers2__caption-feint",block:".offers2__caption-query",query:"button.offers2__caption-query-button",close:".offers2__caption-query-mobile-exit",clear:".offers2__caption-query-import-wipe",input:"input.offers2__caption-query-import-text"},regions:{panel:".offers2__caption-query-result"},events:{"blur @ui.input":function(e){e.stopPropagation(),this.options.rootState.trigger("hideCaptionMask")},"focus @ui.input":function(e){e.stopPropagation(),this.options.rootState.trigger("showCaptionMask"),this.options.rootState.trigger("showResultPanel",this._lastResponseData)},"click @ui.feint":function(e){e.stopPropagation(),this.ui.block.addClass("offers2-search-full-screen"),this.ui.input.focus()},"click @ui.close":function(e){e.stopPropagation(),this.ui.block.removeClass("offers2-search-full-screen")},"click @ui.clear":function(e){e.stopPropagation(),this.ui.clear.removeClass("show"),this.ui.input.val("").trigger("input")},"click @ui.query":function(){var e=this.__getSearchKey();if(e){var t=location.pathname;/\/(business\-)?offers\/*$/i.test(t)?window.isforbusiness?location.href="/"+s.getLanguage()+"/business/business-offers/search?keywords="+encodeURIComponent(e):location.href="/"+s.getLanguage()+"/offers/search?keywords="+encodeURIComponent(e):location.href=t+"?keywords="+encodeURIComponent(e)}},"input @ui.input":function(e){var t=this,n=t.__getSearchKey();n?(t.ui.clear.addClass("show"),t.options.rootState.trigger("getListByKeyword",n)):(t._lastResponseData=null,t.ui.clear.removeClass("show"),t.getRegion("panel").empty())},"enter @ui.input":function(){this.ui.query.trigger("click")}},onRender:function(){this.__initialEventHwd()},__initialEventHwd:function(){var e=this,t=e.options.rootState;e.stopListening(t),e.listenTo(t,"showResultPanel",e.__showResultPanel),e.listenTo(t,"hideResultPanel",e.__hideResultPanel)},__showResultPanel:function(e){var t=this;if(e&&e.key&&e.key===t.__getSearchKey()){t._lastResponseData=e,t.getRegion("panel").show(new r({keyword:e.key,rootState:t.options.rootState,collection:new i.Collection(e.val)}));var n=e.val.length>0,o=i18n.t("offers.suggested_offers"),s=jQuery(t.getRegion("panel").el.firstChild);n&&s.prepend("<div class='offers2__caption-query-result-title'>"+o+"</div>")}else t._lastResponseData=null,t.getRegion("panel").empty()},__hideResultPanel:function(e){e&&(this.ui.block.is(e)||this.ui.block.has(e).length)||this.getRegion("panel").empty()},__getSearchKey:function(){return this.ui.input.val().trim()}})},{"../../../../../config/host":45,"./container/view":1489,backbone:8,"backbone.marionette":6,underscore:42}],1489:[function(e,t,n){var i=e("backbone.marionette"),o=e("./children/view"),r=e("./empty/view");t.exports=i.CollectionView.extend({childView:o,emptyView:r,className:"offers2__caption-query-result-list",childViewOptions:function(e){return{model:e,keyword:this.options.keyword,rootState:this.options.rootState}},emptyViewOptions:function(){return{keyword:this.options.keyword,rootState:this.options.rootState}},initialize:function(){this._closeHandler=jQuery.proxy(this.__closeEventHandler,this)},onRender:function(){this.__delGlobalListener(),this.__addGlobalListener()},onDestroy:function(){this.__delGlobalListener()},__delGlobalListener:function(){jQuery(document).off("click",this._closeHandler)},__addGlobalListener:function(){jQuery(document).on("click",this._closeHandler)},__closeEventHandler:function(e){this.options.rootState.trigger("hideResultPanel",e.target)}})},{"./children/view":1486,"./empty/view":1488,"backbone.marionette":6}],1488:[function(e,t,n){var i=e("backbone.marionette");t.exports=i.ItemView.extend({template:Handlebars.compile(e("./template.hbs")),serializeData:function(){return{keyword:this.options.keyword}}})},{"./template.hbs":1487,"backbone.marionette":6}],1487:[function(e,t,n){t.exports='<div class="offers2__caption-query-result-item hold">{{ local "tours.no_results" }} <strong>{{ keyword }}</strong></div>'},{}],1486:[function(e,t,n){var i=e("backbone.marionette");document.createElement("code");t.exports=i.ItemView.extend({template:Handlebars.compile(e("./template.hbs")),serializeData:function(){for(var e,t,n=this,i=n.model.toJSON(),o=n.options.keyword,r=i.title||"",s=o.toLowerCase(),a=r.toLowerCase(),u=[];(e=a.indexOf(s))>=0;)t=e+s.length,u.push(r.slice(0,e)),u.push("<strong>"+r.slice(e,t)+"</strong>"),a=a.slice(t),r=r.slice(t);return u.push(r),{url:i.url,title:u.join("")}}})},{"./template.hbs":1485,"backbone.marionette":6}],1485:[function(e,t,n){t.exports='<a class="offers2__caption-query-result-item" href="{{ url }}">{{{ title }}}</a>'},{}]},{},[2254]);