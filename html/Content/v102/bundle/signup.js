require=function e(i,t,a){function o(r,s){if(!t[r]){if(!i[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(n)return n(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var d=t[r]={exports:{}};i[r][0].call(d.exports,function(e){var t=i[r][1][e];return o(t?t:e)},d,d.exports,e,i,t,a)}return t[r].exports}for(var n="function"==typeof require&&require,r=0;r<a.length;r++)o(a[r]);return o}({2268:[function(e,i,t){var a=e("../component/layout/default-page-layout.js"),o=e("../component/signup/view"),n=a.extend({ui:{mainWrapper:".main-wrapper"},onRender:function(){this.ui.mainWrapper.prepend((new o).render().el)}});new n({el:jQuery(".global-wrapper")}).render()},{"../component/layout/default-page-layout.js":1082,"../component/signup/view":1948}],1948:[function(e,i,t){var a=(e("underscore"),e("backbone.marionette")),o=e("../calendar/calendar.js"),n=e("./model"),r=e("../ui/password/view.js"),s=e("../ui/validator"),c=(e("underscore.string/sprintf"),e("../../../config/host")),l=(e("moment"),e("../ui/util")),d=e("../../../config/host.js"),u=e("../form/address/view"),p=(e("../ui/date3selects/view"),e("./dialog/view")),m=/sign\-up\-mobile/i.test(window.location.href);i.exports=a.ItemView.extend({el:".signup",template:!1,ui:{wants_newsletter:".checkbox-container .checkbox",socialCheckbox:"[data-bind=FG]",socialFacebook:".wgt-sqbutton-facebook",socialGoogle:".wgt-sqbutton-google",socialLinkedin:".wgt-sqbutton-linkedin",mobileTipDesc:".tip-desc",birthday:"[data-bind=birthday]",title:"[data-bind=title]",country:"[data-bind=country]",gender:"[data-bind=gender]",address:"[data-bind=address]",birthdayPopup:".birthday-calendar-popup",passwordContainer:".passwordContainer",invalidform:".invalid-form",dob:"input[data-bind=birthday]",dobbinder:"[data-bind-to=birthday]",city:"[data-bind=city]",province:"[data-bind=province],[data-bind=state]",postcode:"[data-bind=postal_code]",addressField:".address-field",first_name:"[data-bind=first_name]",last_name:"[data-bind=last_name]",email:"[data-bind=email]",social_content:".social-content",img:"[data-feedback='img']",voice:"[data-feedback='voice']",item_img:"[data-item='img']"},events:{"focus input":"onInputFocused","keypress input[name=birthday]":"hideBirthdayPopup","click .wgt-sqbutton-black":"onSaveClicked","click @ui.socialCheckbox":"selectSocial","click @ui.socialFacebook":"clickFacebook","click @ui.socialGoogle":"clickGoogle","click @ui.socialLinkedin":"clickLinkedin","click @ui.voice":function(){this.IF_CLICK_AUDIO&&this.autoPlay()},"click @ui.img":function(){var e=d.getURL("api","captcha/image?r="+Math.random());jQuery(".code-bottom .captcha-img").each(function(i,t){jQuery(t).attr("src",e)})}},initialize:function(){var e=this;e.IF_CLICK_AUDIO=!0,e.audio=new Audio},autoPlay:function(){var e=this;e.IF_CLICK_AUDIO=!1,e.audio.setAttribute("src",c.getURL("api","captcha/voice?r="+Math.random())),e.audio.load(),e.audio.play(),e.audio.oncanplay=function(){e.audio.play()},e.audio.onended=function(){e.IF_CLICK_AUDIO=!0}},hideBirthdayPopup:function(){this.ui.birthdayPopup.hide()},getQueryParam:function(e){var i=location.hash.match(new RegExp(e+"=([^&]*)"));return i&&i[1]},onInputFocused:function(e){this.ui.birthdayPopup["birthday"===jQuery(e.target).data("bind")?"show":"hide"]()},selectSocial:function(){this._selectSocialCheckBox()},clickFacebook:function(){this._clickSocial(this.ui.socialFacebook,event)},clickGoogle:function(){this._clickSocial(this.ui.socialGoogle,event)},clickLinkedin:function(){this._clickSocial(this.ui.socialLinkedin,event)},onRender:function(){var e=this;e.addressView=new u({formView:e,countryDropDown:e.ui.country,addressInput:e.ui.address,cityInput:e.ui.city,provinceInput:e.ui.province,postcodeInput:e.ui.postcode}),l.country(e.ui.country),l.titlegender(e.ui.title,e.ui.gender),e.model=new n({pc:l.queryparam("pc"),ischeckcaptacha:!0}),e.passwordView=new r({el:e.ui.passwordContainer,bind:{model:e.model,attribute:"password"}}).render(),e.birthdayCalendar=new o({limitTo:"before",allowYearButtons:!0}),e.birthdayCalendar.myEvent.on("select",function(i){e.ui.birthdayPopup.hide(),e.ui.birthday.val(i.format("DD/MM/YYYY")),e.onInputFocusOut({target:e.ui.birthday})},this),e.ui.birthdayPopup.append(e.birthdayCalendar.render().el).hide(),s.bind(this),e._selectSocialCheckBox(),e.__checkThirdParty()},pcFunction:function(){var e=this,i=window.fastTrackForm,t=e.model.get("pc");i&&(i&&"elite"==i&&(t?(e.model.validation.secondaryphone={required:!m,pattern:/^(\(?\+?[0-9]*\)?)?[0-9_\- \(\)]*$/},e.model.set("pc","OCBCMHRELTALC")):e.model.set("pc","OCBCMHRELT")),i&&"premium"==i&&(t?(e.model.validation.secondaryphone={required:!m,pattern:/^(\(?\+?[0-9]*\)?)?[0-9_\- \(\)]*$/},e.model.set("pc","OCBCMHRPRMALC")):e.model.set("pc","OCBCMHRPRM")),i&&"hlfreg"==i&&e.model.set("pc","HLFREG18"))},_selectSocialCheckBox:function(){var e=l.ismobile(),i=this.ui.socialCheckbox.hasClass("checked");i?(this.ui.socialFacebook.removeClass("disabled"),this.ui.socialGoogle.removeClass("disabled"),this.ui.socialLinkedin.removeClass("disabled")):(this.ui.socialFacebook.addClass("disabled"),this.ui.socialGoogle.addClass("disabled"),this.ui.socialLinkedin.addClass("disabled")),e&&(i?this.ui.mobileTipDesc.removeClass("showTip"):this.ui.mobileTipDesc.addClass("showTip"))},_clickSocial:function(e,i){var t=this,a=e.hasClass("disabled");return a?(i.preventDefault(),!1):(t.googleTagTrack(),!0)},__checkThirdParty:function(){var e=this.__getThirdVal();e.type&&e.token&&(""!=this.ui.first_name.val()&&this.ui.first_name.attr("disabled",!0).css({cursor:"not-allowed"}),""!=this.ui.last_name.val()&&this.ui.last_name.attr("disabled",!0).css({cursor:"not-allowed"}),""!=this.ui.email.val()&&this.ui.email.attr("disabled",!0).css({cursor:"not-allowed"}),this.ui.passwordContainer.hide(),this.ui.social_content.hide(),this.model.set({socialmediatype:e.type,token:e.token}))},__getThirdVal:function(){var e=jQuery("#socialmediatype").val(),i=jQuery("#socialmediatoken").val();return{type:e,token:i}},googleTagTrack:function(){gtag("event","conversion",{allow_custom_scripts:!0,send_to:"DC-4867025/websi000/loyal123+unique"})},onSaveClicked:function(e){var i=jQuery(e.currentTarget);if(!i.hasClass("disabled")){var t=this,a=t.getQueryParam("callbackurl")&&decodeURIComponent(t.getQueryParam("callbackurl")),o=this.__getThirdVal();o.type&&o.token&&(t.model.validation.password.required=!1),t.passwordView.validate(),t.trigger("save:form"),t.pcFunction(),t.ui.item_img.length<1&&(t.model.validation.captcha.required=!1,t.model.set("ischeckcaptacha",!1));var n=t.model.isValid(!0);t.model.set("birthday",t.model.get("birthday").replace(/undefined/g,"01")),t.ui.invalidform[n?"removeClass":"addClass"]("input-error not-null"),t.model.set("callbackurl",a),n&&(i.addClass("wgt-sqbutton-change-color").addClass("disabled"),l.loading({container:t.el,errortimeout:3e3,promise:t.model.save({},{emulateJSON:!0,emulateForm:!0,success:function(e,i){var a=t.getQueryParam("callbackurl")&&decodeURIComponent(t.getQueryParam("callbackurl"));if(m){t.googleTagTrack();var o=new p;o.membershipNo=i&&i.profile&&i.profile.MembershipNo,o.on("check:button",function(){o.destroy(),window.location.reload()}),jQuery("body").append(o.render().$el)}else if(t.googleTagTrack(),l.redirect(i.url||a||l.getURL("my","scratchpad")),t.ui.item_img.length>0){var n=d.getURL("api","captcha/image?r="+Math.random());jQuery(".code-bottom .captcha-img").each(function(e,i){jQuery(i).attr("src",n)})}},error:function(e,a){var o,n=i18n.t("signup.email_registered_msg");a?a.responseJSON[0]&&a.responseJSON[0].msg?(o="<p><span class='sg_msg'></span></p>",n=a.responseJSON[0].msg):o="<p><span class='sg_msg'></span><span class='sg_email' style='color: #31a2ac'>enquiry@mymillennium.com.sg</span></p>":o="<p><span class='sg_email'>"+i18n.t("signup.email_crm_error_msg")+"</span></p>",jQuery(".loading-error-block").html(o),jQuery(".sg_msg").html(n),i.removeClass("wgt-sqbutton-change-color").removeClass("disabled"),t.model.validation.password.required=!0}})}))}}});!function(e){var i=e(".member-form-button"),t=e(".signup-member"),a=e(".form-member .close-trigger");i.click(function(){t.toggleClass("active")}),a.click(function(){t.removeClass("active")})}(jQuery)},{"../../../config/host":45,"../../../config/host.js":45,"../calendar/calendar.js":424,"../form/address/view":838,"../ui/date3selects/view":2071,"../ui/password/view.js":2108,"../ui/util":2122,"../ui/validator":2123,"./dialog/view":1946,"./model":1947,"backbone.marionette":6,moment:16,underscore:42,"underscore.string/sprintf":41}],1947:[function(e,i,t){var a=e("underscore"),o=e("backbone"),n=e("../../../config/host.js"),r=e("../ui/validator"),s=e("../../../data/country.json"),c=r.latinRegex3;r.patterns.keyboard,r.latinNumericsSymbols,r.alphaNumerics2,/sign\-up\-mobile/i.test(window.location.href),i.exports=o.Model.extend({url:n.getURL("api","account/signup"),defaults:{facebook:{},google:{},wants_newsletter:!1,select_preferences:!1,socialmediatype:"",token:""},initialize:function(){var e=jQuery.cookie("client_country"),i=a.find(s,function(i){return i.key.indexOf("("+e+")")>-1});!this.get("country")&&i&&this.set("country",i.key)},validation:{password:{required:!0},email:{required:!0,pattern:"email"},postal_code:{required:!1,maxLength:32},first_name:{required:!0,pattern:c,maxLength:254},last_name:{required:!0,pattern:c,maxLength:254},tick:{required:!0},birthday:function(e){return r.validators.date(e,18,!0)},secondaryphone:{required:!1,pattern:/^(\(?\+?[0-9]*\)?)?[0-9_\- \(\)]*$/},pc:{required:!1},captcha:{required:!0}}})},{"../../../config/host.js":45,"../../../data/country.json":47,"../ui/validator":2123,backbone:8,underscore:42}],1946:[function(e,i,t){var a=e("backbone.marionette");i.exports=a.ItemView.extend({template:function(i){return Handlebars.compile(e("./template.hbs"))(i)},events:{"click .tip-button":function(){this.trigger("check:button")}},className:function(){return""},serializeData:function(){return{membershipNo:this.membershipNo}}})},{"./template.hbs":1945,"backbone.marionette":6}],1945:[function(e,i,t){i.exports='\ufeff<div class="tpl-full-screen-mask" style="display: block">\r\n    <div class="tpl-form-submit-succeed">\r\n        <h4 class="tip-title" style="padding-left: 0; text-align: center; text-transform: uppercase; font-size: 1.45rem; color: #fff;">{{local "signup.register_success_title"}}</h4>\r\n        <div class="content-error-tips" style="padding: 0.8rem 0 2rem; background-color: #eee;">\r\n            <img width="150" src="/assets/img/printpreview_millennium-logo.svg">\r\n            <h5 class="tip-copy">{{local "signup.register_success_copy"}}</h5>\r\n            <div style="font-size: 1.4rem; padding-top: 0.8rem;">{{local "signup.register_your_membership_number"}}</div>\r\n            <div style="font-size: 2.4rem; padding-top: 0.5rem;">{{membershipNo}}</div>\r\n            <div class="clearfix" style="overflow:visible;">\r\n                <a class="wgt-sqbutton-blue tip-button" style="width: 12rem; padding: 0;">{{local "signup.register_success_button"}}</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'},{}]},{},[2268]);